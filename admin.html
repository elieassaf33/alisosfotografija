<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Upload - Alisos Fotografija</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { font-family: 'Poppins', sans-serif; padding: 20px; }
        label, input, button { display: block; margin: 10px 0; }
        button { padding: 10px 20px; cursor: pointer; }
        #status { margin-top: 15px; font-weight: bold; }
        #upload-section { display: none; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Admin Login</h1>

    <div id="login-section">
        <label for="email">Email:</label>
        <input type="email" id="email" placeholder="Enter admin email">
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Enter password">
        <button id="loginBtn">Login</button>
        <div id="status"></div>
    </div>

    <div id="upload-section">
        <h2>Upload Image</h2>
        <label for="fileInput">Choose Image:</label>
        <input type="file" id="fileInput">

        <label for="category">Select Category:</label>
        <select id="category">
            <option value="portrait">Studija</option>
            <option value="family">Å eima</option>
            <option value="nature">Gamta</option>
            <option value="events">Renginiai</option>
        </select>

        <button id="uploadBtn">Upload</button>
        <div id="uploadStatus"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC6P-2nngV7gL7f7UeJICkJ_uwOikFFK50",
            authDomain: "alisos-fotografija.firebaseapp.com",
            projectId: "alisos-fotografija",
            storageBucket: "alisos-fotografija.appspot.com",
            messagingSenderId: "394303533680",
            appId: "1:394303533680:web:8839ce95758766463c7ab5",
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth();

        const loginBtn = document.getElementById('loginBtn');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const statusDiv = document.getElementById('status');
        const uploadSection = document.getElementById('upload-section');

        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const categorySelect = document.getElementById('category');
        const uploadStatus = document.getElementById('uploadStatus');

        // Replace this with your admin UID from Firebase Auth
        const ADMIN_UID = "BfeIB1JrBYM1kU4QSW9K8zWDNNP2";

        // Login functionality
        loginBtn.addEventListener('click', async () => {
            const email = emailInput.value;
            const password = passwordInput.value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                if (user.uid !== ADMIN_UID) {
                    statusDiv.textContent = "Not authorized!";
                    await auth.signOut();
                    return;
                }

                statusDiv.textContent = "Login successful!";
                document.getElementById('login-section').style.display = 'none';
                uploadSection.style.display = 'block';

            } catch (error) {
                console.error(error);
                statusDiv.textContent = "Login failed. Check credentials.";
            }
        });

        // Upload functionality
        uploadBtn.addEventListener('click', async () => {
            const file = fileInput.files[0];
            const category = categorySelect.value;
            if (!file) return alert('Select a file!');

            uploadStatus.textContent = 'Uploading to Cloudinary...';

            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', 'studio_upload');
            formData.append('folder', category);

            try {
                const response = await fetch('https://api.cloudinary.com/v1_1/dvwbgfsbg/upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (!data.secure_url) throw new Error('Upload failed');

                uploadStatus.textContent = 'Saving URL to Firestore...';

                await addDoc(collection(db, "photos"), {
                    url: data.secure_url,
                    category: category,
                    caption: file.name,
                    createdAt: serverTimestamp()
                });

                uploadStatus.textContent = 'Upload successful!';
                fileInput.value = '';

            } catch (error) {
                console.error(error);
                uploadStatus.textContent = 'Upload failed. Check console.';
            }
        });
    </script>
</body>
</html>

